extends layout

block content
  .page-container
    // 页面头部
    .page-header
      h1
        i.fas.fa-magic
        | 为您量身定制的电影推荐
      p 基于您的观影偏好，发现您可能会喜欢的电影
      .page-actions
        a.btn(href='/')
          i.fas.fa-home
          | 返回首页
        a.btn(href='/favorites')
          i.fas.fa-heart
          | 我的收藏

    // 推荐电影网格
    .movies-grid
      if movieinfo && movieinfo.length > 0
        each movie in movieinfo
          .movie-card(data-movie-id=movie.movieid)
            .card-top
              if movie.picture
                img(src=movie.picture, alt=movie.moviename)
              else
                .no-poster 暂无图片
              .card-overlay
                .overlay-content
                  if movie.rating
                    .overlay-rating
                      i.fas.fa-star
                      | 推荐度: #{movie.rating.toFixed(1)}/5.0
                  .overlay-action 查看详情
            .card-content
              h3= movie.moviename
              if movie.rating
                .meta
                  span.rating
                    i.fas.fa-star
                    | 推荐度 #{movie.rating.toFixed(1)}/5.0

            .card-actions
              button.action-btn.favorite-btn(onclick=`toggleFavorite(${movie.movieid}, this); event.stopPropagation();`, title='收藏')
                i.far.fa-heart
      else
        .empty-state
          i.fas.fa-film
          h3 暂无推荐结果
          p 请先评价更多电影，让我们更了解您的喜好
          a.btn.btn-primary(href='/select-movies') 去评分

block extraJS
  script(src='/js/favorites.js')
  script.
    // 页面加载时检查收藏状态
    document.addEventListener('DOMContentLoaded', function() {
      const movieCards = document.querySelectorAll('.movie-card');
      const movieIds = Array.from(movieCards).map(card => card.dataset.movieId).filter(id => id);
      if (movieIds.length > 0 && window.appState.isLogin) {
        checkFavoritesStatus(movieIds);
      }
    });
