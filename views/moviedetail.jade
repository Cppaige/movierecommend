extends layout

block content
  .detail-container
    // 背景图区域
    .detail-backdrop(style=`background-image: linear-gradient(to right, rgba(0,0,0,0.9), rgba(0,0,0,0.4)), url('${movie.backdrop || movie.poster}')`)
      .detail-backdrop-content
        h1 #{movie.title}
        if movie.tagline
          p.tagline #{movie.tagline}
        .movie-meta
          span.release-year #{movie.releaseYear}
          span.dot •
          if movie.runtime
            span.runtime #{movie.runtime}分钟
          span.dot •
          span.rating
            i.fas.fa-star
            | #{movie.rating}/10
          if movie.votes > 0
            span.dot •
            span.votes #{movie.votes.toLocaleString()} 人评分

    // 主要内容区域
    .detail-content
      // 海报区域 - 左侧
      .detail-sidebar
        img(src=movie.poster, alt=movie.title, loading="lazy")

        // 收藏按钮
        button.btn.btn-primary.favorite-btn(data-movie-id=movie.id, onclick=`toggleFavorite(${movie.id}, this)`)
          i.far.fa-heart
          span 收藏这部电影

        // 评分卡片
        .card.rating-card
          div.rating-display
            span.rating-value #{movie.rating}
            span.rating-max /10
          span.rating-label 用户评分
          if movie.votes > 0
            span.rating-count #{movie.votes.toLocaleString()} 人评分

      // 详情信息区域 - 右侧
      .detail-main
        // 剧情简介
        .detail-section
          h2 剧情简介
          p #{movie.description || '暂无简介'}

        // 基本信息
        .detail-section
          h2 基本信息
          .detail-info-grid
            span.detail-label 导演：
            span.detail-value #{movie.director || '未知'}

            span.detail-label 编剧：
            span.detail-value #{movie.writer || '未知'}

            span.detail-label 主演：
            span.detail-value #{movie.actors || '未知'}

            span.detail-label 类型：
            .detail-value
              if movie.genres.length > 0
                each genre in movie.genres
                  span.genre #{genre}
              else
                | 未知

            span.detail-label 上映日期：
            span.detail-value #{movie.releaseDate || '未知'}

            span.detail-label 制片国家/地区：
            span.detail-value #{movie.country || '未知'}

            span.detail-label 语言：
            span.detail-value #{movie.language || '未知'}

            if movie.imdbRating
              span.detail-label IMDb评分：
              span.detail-value #{movie.imdbRating}

    // 返回链接
    .page-actions(style='margin-top: 40px;')
      a.btn.btn-secondary(href="/movielibrary")
        i.fas.fa-arrow-left
        | 返回电影库

block extraJS
  script(src='/js/favorites.js')
  script.
    // 页面加载时检查收藏状态
    document.addEventListener('DOMContentLoaded', function() {
      const movieId = document.querySelector('.favorite-btn').dataset.movieId;
      if (movieId && window.appState.isLogin) {
        checkFavoritesStatus([movieId]);
      }
    });
